# Makefile as used on USyd SoP Network Machines
# COMPILER_VENDOR = gnu95
COMPILER_VENDOR = intelem

SUBROUTINES_FOR_PYTHON = py_calc_modes.f

SS_LIB_LOCATION = /suphys/bjorn/Usyd_Running/f2py-pcpv/PCPV/Fortran_pcpv/SS_install/lib
ARPACK_LIB_LOCATION = /suphys/bjorn/Usyd_Running/f2py-pcpv/PCPV/Fortran_pcpv/ARPACK
UMFPACK_NAME = umf4_f77zwrapper64.o

LDADD=-lrt
 
pcpv.so: pcpv.pyf *.f
	f2py -c pcpv.pyf *.f --fcompiler=$(COMPILER_VENDOR) \
        --link-lapack_opt --link-blas_opt \
        $(LDADD) -L$(ARPACK_LIB_LOCATION) -larpack \
        $(SS_LIB_LOCATION)/$(UMFPACK_NAME) \
        -L$(SS_LIB_LOCATION) -lumfpack -lamd -lcholmod \
        -lcolamd -lcamd -lmetis -lccolamd -lamd -lsuitesparseconfig 


pcpv.pyf: $(SUBROUTINES_FOR_PYTHON)
	f2py -m pcpv -h pcpv.pyf $(SUBROUTINES_FOR_PYTHON) --overwrite-signature

purge:
	-rm pcpv.pyf
	-rm pcpv.so